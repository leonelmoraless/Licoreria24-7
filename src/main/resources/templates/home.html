<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!-- 
    Interfaz principal del sistema 
-->

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Licorería 24/7</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Iconos -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Estilos propios -->
    <link rel="stylesheet" th:href="@{/css/estilos.css}">
</head>

<body class="home-bg">
    <div class="d-flex main-wrapper home-bg">

        <!-- BARRA LATERAL (MENÚ) -->
        <nav class="sidebar bg-dark text-white d-flex flex-column p-3">
            <h4 class="text-center text-white mb-4 sidebar-title">
                <img th:src="@{/imagenes/logo.jpg}" alt="Logo" class="sidebar-logo">
                Licorería 24/7
            </h4>

            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item">
                    <a th:href="@{/home}" class="nav-link text-white active">
                        <i class="bi bi-grid-fill me-2"></i> Dashboard
                    </a>
                </li>

                <!-- Solo visible para ADMINISTRADORES -->
                <li class="nav-item" sec:authorize="hasAuthority('Administrador')">
                    <a th:href="@{/compras}" class="nav-link text-white">
                        <i class="bi bi-cart-fill me-2"></i> Registrar Compra
                    </a>
                </li>
                <li class="nav-item" sec:authorize="hasAuthority('Administrador')">
                    <a th:href="@{/historial-compras}" class="nav-link text-white">
                        <i class="bi bi-archive-fill me-2"></i> Historial Compras
                    </a>
                </li>

                <!-- Visible para TODOS (Admin y Empleado) -->
                <li class="nav-item" sec:authorize="hasAnyAuthority('Administrador', 'Empleado')">
                    <a th:href="@{/productos}" class="nav-link text-white">
                        <i class="bi bi-box-seam-fill me-2"></i> Productos
                    </a>
                </li>

                <li class="nav-item" sec:authorize="hasAuthority('Administrador')">
                    <a th:href="@{/proveedores}" class="nav-link text-white">
                        <i class="bi bi-truck me-2"></i> Proveedores
                    </a>
                </li>
                <li class="nav-item" sec:authorize="hasAuthority('Administrador')">
                    <a th:href="@{/usuario}" class="nav-link text-white">
                        <i class="bi bi-people-fill me-2"></i> Usuarios
                    </a>
                </li>
            </ul>
            <hr>

            <!-- Información del Usuario Logueado -->
            <div class="sidebar-user-info text-center mb-2">
                <span sec:authentication="name" class="d-block small"></span>
                <span sec:authentication="principal.authorities" class="d-block small badge bg-info"></span>
            </div>

            <!-- Botones de Acción -->
            <button class="btn btn-outline-warning w-100 mb-2" data-bs-toggle="modal"
                data-bs-target="#modalCambiarClave">
                <i class="bi bi-key-fill me-2"></i> Cambiar Contraseña
            </button>
            <form th:action="@{/logout}" method="post">
                <button type="submit" class="btn btn-outline-danger w-100">
                    <i class="bi bi-box-arrow-left me-2"></i> Cerrar Sesión
                </button>
            </form>
        </nav>

        <!-- CONTENIDO PRINCIPAL -->
        <main class="content-area p-4">
            <!-- Saludo de bienvenida -->
            <h1 class="mb-4 mensaje-bienvenida" th:text="${nombreUsuario}"></h1>

            <!-- Mensajes de Alerta (Éxito/Error) -->
            <div th:if="${mensajeExito}" class="alert alert-success alert-dismissible fade show" role="alert"
                th:text="${mensajeExito}"></div>
            <div th:if="${mensajeError}" class="alert alert-danger alert-dismissible fade show" role="alert"
                th:text="${mensajeError}"></div>

            <!-- TARJETAS DE ACCESO RÁPIDO -->
            <div class="row g-4">
                <!-- Historial Compras -->
                <div class="col-md-4" sec:authorize="hasAuthority('Administrador')">
                    <a th:href="@{/historial-compras}" class="card dashboard-card shadow-sm">
                        <div class="card-body text-center">
                            <img th:src="@{/imagenes/historialCompra.png}" alt="historial-compras" width="150"
                                height="150" class="mb-3">
                            <h5 class="card-title">Historial Compras</h5>
                        </div>
                    </a>
                </div>

                <!-- Registrar Compra -->
                <div class="col-md-4" sec:authorize="hasAuthority('Administrador')">
                    <a th:href="@{/compras}" class="card dashboard-card shadow-sm">
                        <div class="card-body text-center">
                            <img th:src="@{/imagenes/compra.png}" alt="Registrar Compra" width="150" height="150"
                                class="mb-3">
                            <h5 class="card-title">Registrar Compra</h5>
                        </div>
                    </a>
                </div>

                <!-- Productos -->
                <div class="col-md-4" sec:authorize="hasAnyAuthority('Administrador', 'Empleado')">
                    <a th:href="@{/productos}" class="card dashboard-card shadow-sm">
                        <div class="card-body text-center">
                            <img th:src="@{/imagenes/productos.png}" alt="Productos" width="150" height="150"
                                class="mb-3">
                            <h5 class="card-title">Gestión de Productos</h5>
                        </div>
                    </a>
                </div>

                <!-- Proveedores -->
                <div class="col-md-4" sec:authorize="hasAuthority('Administrador')">
                    <a th:href="@{/proveedores}" class="card dashboard-card shadow-sm">
                        <div class="card-body text-center">
                            <img th:src="@{/imagenes/proveedor.png}" alt="proveedores" width="150" height="150"
                                class="mb-3">
                            <h5 class="card-title">Gestión de Proveedores</h5>
                        </div>
                    </a>
                </div>

                <!-- Usuarios -->
                <div class="col-md-4" sec:authorize="hasAuthority('Administrador')">
                    <a th:href="@{/usuario}" class="card dashboard-card shadow-sm">
                        <div class="card-body text-center">
                            <img th:src="@{/imagenes/Usuarios.png}" alt="usuario" width="150" height="150" class="mb-3">
                            <h5 class="card-title">Gestión de Usuarios</h5>
                        </div>
                    </a>
                </div>
            </div>

            <!-- MODAL: CAMBIAR CONTRASEÑA -->
            <div class="modal fade" id="modalCambiarClave" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Cambiar Contraseña</h5>
                        </div>
                        <form th:action="@{/cambiar-contrasena}" method="post">
                            <div class="modal-body">
                                <div class="mb-3">
                                    <label for="contrasenaActual" class="form-label">Contraseña Actual</label>
                                    <input type="password" class="form-control" id="contrasenaActual"
                                        name="contrasenaActual" required>
                                </div>
                                <div class="mb-3">
                                    <label for="nuevaContrasena" class="form-label">Nueva Contraseña</label>
                                    <input type="password" class="form-control" id="nuevaContrasena"
                                        name="nuevaContrasena" required>
                                </div>
                                <div class="mb-3">
                                    <label for="confirmarContrasena" class="form-label">Confirmar Nueva
                                        Contraseña</label>
                                    <input type="password" class="form-control" id="confirmarContrasena"
                                        name="confirmarContrasena" required>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary"
                                    data-bs-dismiss="modal">Cancelar</button>
                                <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/scripts.js}"></script>
</body>

</html>